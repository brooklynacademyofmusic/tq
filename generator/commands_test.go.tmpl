{{ print "// Code generated by tq/generator; DO NOT EDIT." }}

package cmd

import (
	"testing"
    "regexp"

	"github.com/stretchr/testify/assert"
    "github.com/skysyzygy/tq/tq"
)

{{ $op := .op }}
{{- range $key, $commands := .commands }}
{{- range $commands }}
func Test_{{ print $op "_" $key "_" .Variant "_cmd" }}(t *testing.T) {
        command := {{ print $op "_" $key "_cmd" }}
        use := command.Use

        {{ if ne .Variant "" -}}
        flag := command.Flag("{{ .Variant }}")
        if flag != nil {
            flag.Value.Set("true")
            use = flag.Usage
        }
        {{ end -}}

		input := regexp.MustCompile(`\{.+\}`).FindString(use)
        out, err := tq.CaptureOutput(func(){
            // PreRun: tqInit
            command.PreRun(command, nil)
            {{`//Use: {{ print $key " " $command.Usage }},`}}
            command.Run(command, []string{input})
        })
    
        // Note these are backwards right now to ensure passing
        assert.NotEmpty(t, string(err))
        assert.Empty(t, string(out))
        
}
{{ end }}
{{- end }}